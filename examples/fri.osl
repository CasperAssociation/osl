-- A verifier for a simple version of FRI.

def codewordLength : N := 256N.

data F ~= Fin(270497897142230380135924736767050121217).

def cardinality : N := 270497897142230380135924736767050121217N.

def generator : F := to(F)(fin(85408008396924667383611388730472331217)).

def toN : F -> N
  := \x : F => cast(from(F)(x)).

def add : F -> F -> F -> Prop
  := \a : F => \b : F => \c : F
  => some d : N < cardinality,
     (toN(a) +N toN(b)) = (toN(c) +N (cardinality *N d)).

def mul : F -> F -> F -> Prop
  := \a : F => \b : F => \c : F
  => some d : N < cardinality,
     (toN(a) *N toN(b)) = (toN(c) +N (cardinality *N d)).

def isPowerOf2 : Fin(664613997892457936451903530140172289) -> Prop
  := \x : Fin(664613997892457936451903530140172289)
  => (x = fin(1)) | (x = fin(2)) | (x = fin(4)) | (x = fin(8)) | (x = fin(16)) | (x = fin(32)) | (x = fin(64)) | (x = fin(128)) | (x = fin(256)) | (x = fin(512)) | (x = fin(1024)) | (x = fin(2048)) | (x = fin(4096)) | (x = fin(8192)) | (x = fin(16384)) | (x = fin(32768)) | (x = fin(65536)) | (x = fin(131072)) | (x = fin(262144)) | (x = fin(524288)) | (x = fin(1048576)) | (x = fin(2097152)) | (x = fin(4194304)) | (x = fin(8388608)) | (x = fin(16777216)) | (x = fin(33554432)) | (x = fin(67108864)) | (x = fin(134217728)) | (x = fin(268435456)) | (x = fin(536870912)) | (x = fin(1073741824)) | (x = fin(2147483648)) | (x = fin(4294967296)) | (x = fin(8589934592)) | (x = fin(17179869184)) | (x = fin(34359738368)) | (x = fin(68719476736)) | (x = fin(137438953472)) | (x = fin(274877906944)) | (x = fin(549755813888)) | (x = fin(1099511627776)) | (x = fin(2199023255552)) | (x = fin(4398046511104)) | (x = fin(8796093022208)) | (x = fin(17592186044416)) | (x = fin(35184372088832)) | (x = fin(70368744177664)) | (x = fin(140737488355328)) | (x = fin(281474976710656)) | (x = fin(562949953421312)) | (x = fin(1125899906842624)) | (x = fin(2251799813685248)) | (x = fin(4503599627370496)) | (x = fin(9007199254740992)) | (x = fin(18014398509481984)) | (x = fin(36028797018963968)) | (x = fin(72057594037927936)) | (x = fin(144115188075855872)) | (x = fin(288230376151711744)) | (x = fin(576460752303423488)) | (x = fin(1152921504606846976)) | (x = fin(2305843009213693952)) | (x = fin(4611686018427387904)) | (x = fin(9223372036854775808)) | (x = fin(18446744073709551616)) | (x = fin(36893488147419103232)) | (x = fin(73786976294838206464)) | (x = fin(147573952589676412928)) | (x = fin(295147905179352825856)) | (x = fin(590295810358705651712)) | (x = fin(1180591620717411303424)) | (x = fin(2361183241434822606848)) | (x = fin(4722366482869645213696)) | (x = fin(9444732965739290427392)) | (x = fin(18889465931478580854784)) | (x = fin(37778931862957161709568)) | (x = fin(75557863725914323419136)) | (x = fin(151115727451828646838272)) | (x = fin(302231454903657293676544)) | (x = fin(604462909807314587353088)) | (x = fin(1208925819614629174706176)) | (x = fin(2417851639229258349412352)) | (x = fin(4835703278458516698824704)) | (x = fin(9671406556917033397649408)) | (x = fin(19342813113834066795298816)) | (x = fin(38685626227668133590597632)) | (x = fin(77371252455336267181195264)) | (x = fin(154742504910672534362390528)) | (x = fin(309485009821345068724781056)) | (x = fin(618970019642690137449562112)) | (x = fin(1237940039285380274899124224)) | (x = fin(2475880078570760549798248448)) | (x = fin(4951760157141521099596496896)) | (x = fin(9903520314283042199192993792)) | (x = fin(19807040628566084398385987584)) | (x = fin(39614081257132168796771975168)) | (x = fin(79228162514264337593543950336)) | (x = fin(158456325028528675187087900672)) | (x = fin(316912650057057350374175801344)) | (x = fin(633825300114114700748351602688)) | (x = fin(1267650600228229401496703205376)) | (x = fin(2535301200456458802993406410752)) | (x = fin(5070602400912917605986812821504)) | (x = fin(10141204801825835211973625643008)) | (x = fin(20282409603651670423947251286016)) | (x = fin(40564819207303340847894502572032)) | (x = fin(81129638414606681695789005144064)) | (x = fin(162259276829213363391578010288128)) | (x = fin(324518553658426726783156020576256)) | (x = fin(649037107316853453566312041152512)) | (x = fin(1298074214633706907132624082305024)) | (x = fin(2596148429267413814265248164610048)) | (x = fin(5192296858534827628530496329220096)) | (x = fin(10384593717069655257060992658440192)) | (x = fin(20769187434139310514121985316880384)) | (x = fin(41538374868278621028243970633760768)) | (x = fin(83076749736557242056487941267521536)) | (x = fin(166153499473114484112975882535043072)) | (x = fin(332306998946228968225951765070086144)) | (x = fin(664613997892457936451903530140172288)).

def initRoot : F := to(F)(fin(85408008396924667383611388730472331217)).

def initOrder : Fin(664613997892457936451903530140172289)
  := 664613997892457936451903530140172288N.

def isPrimitiveNthRoot : Fin(664613997892457936451903530140172289) -> F -> Prop
  := \n : Fin(664613997892457936451903530140172289) => \r : F
  => (n <= initOrder)
   & isPowerOf2(n)
   & (some f : Fin(119) ->^119 (Fin(664613997892457936451903530140172289) * F),
      (f(fin(0)) = (initOrder, initRoot))
    & (pi2(f(fin(118))) = r)
    & (all i : Fin(118),
       let i' : Fin(119) := cast(cast(i) +N 1N);
       let mx : Fin(664613997892457936451903530140172289) * F := f(cast(i));
       let mx' : Fin(664613997892457936451903530140172289) * F := f(i');
       let m : N := cast(pi1(mx));
       let x : F := pi2(mx);
       let m' : N := cast(pi1(mx'));
       let x' : F := pi2(mx');
       ((n = m) & (m = m'))
     | (!(n = m) & ((2N *N m') = m) & mul(x, x, x')))).
