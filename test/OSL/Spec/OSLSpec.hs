{-# LANGUAGE GeneralizedNewtypeDeriving #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes #-}


module OSL.Spec.OSLSpec (spec) where


import Control.Monad (forM_)
import Data.String (IsString)
import OSL.EntryPoint (runMain)
import Test.Syd (Spec, describe, it, shouldBe, liftIO)
import Text.RawString.QQ (r)


spec :: Spec
spec =
  describe "OSL" $
    forM_ testCases runTestCase


data TestCase = TestCase TestFile TestName Expectation


newtype TestFile = TestFile String
  deriving IsString


newtype TestName = TestName String
  deriving IsString


newtype Expectation = Expectation String
  deriving IsString


runTestCase :: TestCase -> Spec
runTestCase (TestCase (TestFile fileName) (TestName testName) (Expectation expected)) =
  it ("produces the expected result on " <> fileName
        <> " " <> testName) $ do
    result <- liftIO $ runMain ("examples/" <> fileName <> ".osl") testName
    result `shouldBe` expected


testCases :: [TestCase]
testCases =
  [ TestCase "false" "false"
    [r|Translated OSL:
(0 = 1)|]

  , TestCase "positive" "isPositive"
    [r|Translated OSL:
(1 <= 0^0)|]

  , TestCase "sudoku" "problemIsSolvable"
    [r|Translated OSL:
(some <9(<9, <9), ((all <9, (all <9, (((4^2(0^0, 1^0) = 0) & ((4^2(0^0, 1^0) = 0) | (3^2(0^0, 1^0) = 0))) | ((4^2(0^0, 1^0) = 1) & ((4^2(0^0, 1^0) = 0) | (3^2(0^0, 1^0) = 0^2(0^0, 1^0))))))) & (((all <9, (all <9, (some <9, (0^2(2^0, 0^0) = 1^0)))) & (all <9, (all <9, (some <9, (0^2(0^0, 2^0) = 1^0))))) & (all <3, (all <3, (all <9, (some <3, (some <3, (0^2(((3 * 3^0) + 0^0), ((3 * 4^0) + 1^0)) = 2^0)))))))))|]

  , TestCase "regressions/name-clash-bug-1" "foo"
    [r|Translated OSL:
(1^1(0) = 0)|]

  , TestCase "regressions/name-clash-bug-2" "foo"
    [r|Translated OSL:
(0^0 = 0^0)|]

  , TestCase "orbis" "accepts"
    [r|Translated OSL:
(0 = 0)|]

  , TestCase "orbis" "isProd"
    [r|Translated OSL:
((32 * 2^0) = (0^0 * 1^0))|]

  , TestCase "orbis" "roundsUpTo"
    [r|Translated OSL:
((0^0 <= (32 * 1^0)) & (((32 * 1^0) + (-1 * 0^0)) <= (32 + -1)))|]

  , TestCase "orbis" "paysFeeToCorrectAddress"
    [r|Translated OSL:
(some <36^0, ((20^1(0^0) = 6^0) & (all <41^0, ((45^2(41^1(0^0), 42^1(0^0)) = 29^3(41^1(0^0), 42^1(0^0))) & ((45^2(41^1(0^0), 42^1(0^0)) = 0) | (39^2(41^1(0^0), 42^1(0^0)) = 23^3(1^0, 41^1(0^0), 42^1(0^0))))))))|]

  , TestCase "orbis" "checkCost"
    [r||]

  , TestCase "orbis" "feeRequirementMet"
    [r||]

  , TestCase "orbis" "txExists"
    [r|Translated OSL:
!(69^2(107^0, 108^0) = 0)|]

  , TestCase "orbis" "inputExists"
    [r|Translated OSL:
((some <4096, (some <4096, (some <4096, (((115^0 = 0) & (((115^0 = 0) & (((110^0 = 0^0) & (111^0 = 1^0)) & (112^0 = 2^0))) | ((115^0 = 1) & ((113^0 = 0) & (114^0 = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((114^0 = 0) & (((114^0 = 0) & (((109^0 = 0) & (110^0 = 0)) & (111^0 = 0))) | ((114^0 = 1) & ((112^0 = 0^0) & (113^0 = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0)))))))|]

  , TestCase "orbis" "spendingInputExists"
    [r|Translated OSL:
((some <4096, (some <4096, (some <4096, (((115^0 = 0) & (((115^0 = 0) & (((110^0 = 0^0) & (111^0 = 1^0)) & (112^0 = 2^0))) | ((115^0 = 1) & ((113^0 = 0) & (114^0 = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((114^0 = 0) & (((114^0 = 0) & (((109^0 = 0) & (110^0 = 0)) & (111^0 = 0))) | ((114^0 = 1) & ((112^0 = 0^0) & (113^0 = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0)))))))|]

  , TestCase "orbis" "referenceInputExists"
    [r|Translated OSL:
((some <4096, (some <4096, (some <4096, (((115^0 = 0) & (((115^0 = 0) & (((110^0 = 0^0) & (111^0 = 1^0)) & (112^0 = 2^0))) | ((115^0 = 1) & ((113^0 = 0) & (114^0 = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((114^0 = 0) & (((114^0 = 0) & (((109^0 = 0) & (110^0 = 0)) & (111^0 = 0))) | ((114^0 = 1) & ((112^0 = 0^0) & (113^0 = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0)))))))|]

  , TestCase "orbis" "inputsExist"
    [r|Translated OSL:
((all <113^0, ((some <4096, (some <4096, (some <4096, (((112^1(3^0) = 0) & (((112^1(3^0) = 0) & (((107^1(3^0) = 0^0) & (108^1(3^0) = 1^0)) & (109^1(3^0) = 2^0))) | ((112^1(3^0) = 1) & ((110^1(3^0) = 0) & (111^1(3^0) = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((112^1(2^0) = 0) & (((112^1(2^0) = 0) & (((107^1(2^0) = 0) & (108^1(2^0) = 0)) & (109^1(2^0) = 0))) | ((112^1(2^0) = 1) & ((110^1(2^0) = 0^0) & (111^1(2^0) = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0)))))))) & (all <120^0, ((some <4096, (some <4096, (some <4096, (((119^1(3^0) = 0) & (((119^1(3^0) = 0) & (((114^1(3^0) = 0^0) & (115^1(3^0) = 1^0)) & (116^1(3^0) = 2^0))) | ((119^1(3^0) = 1) & ((117^1(3^0) = 0) & (118^1(3^0) = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((119^1(2^0) = 0) & (((119^1(2^0) = 0) & (((114^1(2^0) = 0) & (115^1(2^0) = 0)) & (116^1(2^0) = 0))) | ((119^1(2^0) = 1) & ((117^1(2^0) = 0^0) & (118^1(2^0) = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0)))))))))|]

  , TestCase "orbis" "isSignatory"
    [r|Translated OSL:
(some <61^0, (60^1(0^0) = 63^0))|]

  , TestCase "orbis" "isRelatedScriptAddress"
    [r|Translated OSL:
(some <30^0, ((1 = 29^1(0^0)) & ((1 = 0) | (63^0 = 28^1(0^0)))))|]

  , TestCase "orbis" "isAuthorizedAddress"
    [r|Translated OSL:
((some <61^0, (60^1(0^0) = 63^0)) | (some <30^0, ((1 = 29^1(0^0)) & ((1 = 0) | (63^0 = 28^1(0^0))))))|]

  , TestCase "orbis" "inputAddressesAreAuthorized"
    [r|Translated OSL:
(all <113^0, ((some <4096, (some <4096, (some <4096, (some <4096, ((((112^1(4^0) = 0) & (((112^1(4^0) = 0) & (((107^1(4^0) = 1^0) & (108^1(4^0) = 2^0)) & (109^1(4^0) = 3^0))) | ((112^1(4^0) = 1) & ((110^1(4^0) = 0) & (111^1(4^0) = 0))))) & ((some <173^0, (167^1(0^0) = 1^0)) | (some <142^0, ((1 = 136^1(0^0)) & ((1 = 0) | (1^0 = 135^1(0^0))))))) & (0^0 = 16^3(1^0, 2^0, 3^0))))))) | (some <4096, (some <4096, (some <4096, ((!(85^1(1^0) = 0) & ((some <172^0, (167^1(0^0) = 1^0)) | (some <141^0, ((1 = 136^1(0^0)) & ((1 = 0) | (1^0 = 135^1(0^0))))))) & (0^0 = 71^2(1^0, 2^0))))))))|]

  , TestCase "orbis" "txBalances"
    [r||]

  , TestCase "orbis" "spendingScriptsAcceptTx"
    [r|Translated OSL:
(all <37^0, (!(36^1(0^0) = 0) | (0 = 0)))|]

  , TestCase "orbis" "mintingScriptsAcceptTx"
    [r|Translated OSL:
(all <50^0, (!(64^1(51^1(0^0)) = 0) & (0 = 0)))|]

  , TestCase "orbis" "scriptsAcceptTx"
    [r|Translated OSL:
((all <37^0, (!(36^1(0^0) = 0) | (0 = 0))) & (all <50^0, (!(64^1(51^1(0^0)) = 0) & (0 = 0))))|]

  , TestCase "orbis" "signatureExists"
    [r|Translated OSL:
(0 = 0)|]

  , TestCase "orbis" "isSignedByAllSignatories"
    [r|Translated OSL:
(all <63^0, (0 = 0))|]

  , TestCase "orbis" "paysEnoughFee"
    [r||]

  , TestCase "orbis" "txSpendingInputsPrecedeTx"
    [r|Translated OSL:
(all <8^0, ((((7^1(0^0) * 2^1(0^0)) + ((1 + (-1 * 7^1(0^0))) * 5^1(0^0))) + 1) <= 1^0))|]

  , TestCase "orbis" "txReferenceInputsPrecedeTx"
    [r|Translated OSL:
(all <15^0, ((((14^1(0^0) * 9^1(0^0)) + ((1 + (-1 * 14^1(0^0))) * 12^1(0^0))) + 1) <= 1^0))|]

  , TestCase "orbis" "txInputsPrecedeTx"
    [r|Translated OSL:
((all <8^0, ((((7^1(0^0) * 2^1(0^0)) + ((1 + (-1 * 7^1(0^0))) * 5^1(0^0))) + 1) <= 1^0)) & (all <15^0, ((((14^1(0^0) * 9^1(0^0)) + ((1 + (-1 * 14^1(0^0))) * 12^1(0^0))) + 1) <= 1^0)))|]

  , TestCase "orbis" "txIsInValidRange"
    [r|Translated OSL:
((60^0 <= 0^0) & (0^0 <= 61^0))|]

  , TestCase "orbis" "txIsValid"
    [r||]

  , TestCase "orbis" "leafSignatureExists"
    [r|Translated OSL:
(1 = 1)|]

  , TestCase "orbis" "leavesExist"
    [r|Translated OSL:
(all <93^0, ((some <4096, (some <4096, (some <4096, (((99^1(3^0) = 0) & (((99^1(3^0) = 0) & (((94^1(3^0) = 0^0) & (95^1(3^0) = 1^0)) & (96^1(3^0) = 2^0))) | ((99^1(3^0) = 1) & ((97^1(3^0) = 0) & (98^1(3^0) = 0))))) & ((some <4096, (some <4096, (some <4096, (((0 = 0) & (((0 = 0) & (((3^0 = 0^0) & (4^0 = 1^0)) & (5^0 = 2^0))) | ((0 = 1) & ((0 = 0) & (0 = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((0 = 0) & (((0 = 0) & (((2^0 = 0) & (3^0 = 0)) & (4^0 = 0))) | ((0 = 1) & ((0 = 0^0) & (0 = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0))))))))))) | (some <4096, (some <4096, (((99^1(2^0) = 0) & (((99^1(2^0) = 0) & (((94^1(2^0) = 0) & (95^1(2^0) = 0)) & (96^1(2^0) = 0))) | ((99^1(2^0) = 1) & ((97^1(2^0) = 0^0) & (98^1(2^0) = 1^0))))) & ((some <4096, (some <4096, (some <4096, (((0 = 0) & (((0 = 0) & (((0 = 0^0) & (0 = 1^0)) & (0 = 2^0))) | ((0 = 1) & ((3^0 = 0) & (4^0 = 0))))) & ((1 + 2^0) <= ((69^2(0^0, 1^0) * 32^2) + ((1 + (-1 * 69^2(0^0, 1^0))) * 0))))))) | (some <4096, (some <4096, (((0 = 0) & (((0 = 0) & (((0 = 0) & (0 = 0)) & (0 = 0))) | ((0 = 1) & ((2^0 = 0^0) & (3^0 = 1^0))))) & ((1 + 1^0) <= ((85^1(0^0) * 81^1) + ((1 + (-1 * 85^1(0^0))) * 0))))))))))))|]

  , TestCase "orbis" "leavesAreSigned"
    [r|Translated OSL:
(all <93^0, (1 = 1))|]

  , TestCase "orbis" "txConsumesItsInputs"
    [r|Translated OSL:
(all <37^0, ((28^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 1) & ((28^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) | ((14^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & (((14^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & ((6^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 30^0) & (7^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 31^0))) | ((14^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 1) & ((13^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & (((13^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & (((8^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & (9^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0)) & (10^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0))) | ((13^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 1) & ((11^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0) & (12^6(36^1(0^0), 31^1(0^0), 32^1(0^0), 33^1(0^0), 34^1(0^0), 35^1(0^0)) = 0)))))))))))|]

  , TestCase "orbis" "noTxTxDoubleSpend"
    [r|Translated OSL:
(all <93^0, (all <37^2, ((28^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 1) & ((28^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) | ((14^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & (((14^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & ((6^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 94^1(1^0)) & (7^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 95^1(1^0)))) | ((14^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 1) & ((13^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & (((13^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & (((8^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & (9^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0)) & (10^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0))) | ((13^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 1) & ((11^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) & (12^6(36^3(94^1(1^0), 95^1(1^0), 0^0), 31^3(94^1(1^0), 95^1(1^0), 0^0), 32^3(94^1(1^0), 95^1(1^0), 0^0), 33^3(94^1(1^0), 95^1(1^0), 0^0), 34^3(94^1(1^0), 95^1(1^0), 0^0), 35^3(94^1(1^0), 95^1(1^0), 0^0)) = 0))))))))))))|]

  , TestCase "orbis" "noTxLeafDoubleSpend"
    [r|Translated OSL:
(all <122^0, ((1 = 28^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & ((1 = 0) | ((0 = 14^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & (((0 = 0) & ((0 = 6^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & (0 = 7^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))))) | ((0 = 1) & ((128^1(0^0) = 13^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & (((128^1(0^0) = 0) & (((123^1(0^0) = 8^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & (124^1(0^0) = 9^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0)))) & (125^1(0^0) = 10^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))))) | ((128^1(0^0) = 1) & ((126^1(0^0) = 11^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0))) & (127^1(0^0) = 12^6(128^1(0^0), 123^1(0^0), 124^1(0^0), 125^1(0^0), 126^1(0^0), 127^1(0^0)))))))))))))|]

  , TestCase "orbis" "noDoubleSpend"
    [r||]

  , TestCase "orbis" "referencesAreUnspent"
    [r|Translated OSL:
(all <93^0, (all <44^2, ((28^6(43^3(94^1(1^0), 95^1(1^0), 0^0), 38^3(94^1(1^0), 95^1(1^0), 0^0), 39^3(94^1(1^0), 95^1(1^0), 0^0), 40^3(94^1(1^0), 95^1(1^0), 0^0), 41^3(94^1(1^0), 95^1(1^0), 0^0), 42^3(94^1(1^0), 95^1(1^0), 0^0)) = 0) | (some <4096, (some <4096, ((94^1(3^0) <= 0^0) & ((28^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 1) & ((28^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) | ((14^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & (((14^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & ((6^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0^0) & (7^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 1^0))) | ((14^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 1) & ((13^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & (((13^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & (((8^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & (9^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0)) & (10^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0))) | ((13^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 1) & ((11^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0) & (12^6(43^3(94^1(3^0), 95^1(3^0), 2^0), 38^3(94^1(3^0), 95^1(3^0), 2^0), 39^3(94^1(3^0), 95^1(3^0), 2^0), 40^3(94^1(3^0), 95^1(3^0), 2^0), 41^3(94^1(3^0), 95^1(3^0), 2^0), 42^3(94^1(3^0), 95^1(3^0), 2^0)) = 0))))))))))))))))|]

  , TestCase "orbis" "valueInAssetClasses"
    [r|Translated OSL:
(all <6^0, (some <3^0, ((7^1(1^0) = 0^1(0^0)) & (8^1(1^0) = 1^1(0^0)))))|]

  , TestCase "orbis" "mintInAssetClasses"
    [r|Translated OSL:
(all <6^0, (some <3^0, ((7^1(1^0) = 0^1(0^0)) & (8^1(1^0) = 1^1(0^0)))))|]

  , TestCase "orbis" "assetClassesCohere"
    [r|Translated OSL:
((all <67^0, (((all <39^2, (some <4^0, ((40^3(1^0) = 0^1(0^0)) & (41^3(1^0) = 1^1(0^0))))) & (all <48^2, (some <4^0, ((49^3(1^0) = 0^1(0^0)) & (50^3(1^0) = 1^1(0^0)))))) & (all <35^2, (all <23^3, (some <5^0, ((24^4(1^0) = 0^1(0^0)) & (25^4(1^0) = 1^1(0^0)))))))) & (all <85^0, (all <84^1, (all <78^2, (some <5^0, ((79^3(1^0) = 0^1(0^0)) & (80^3(1^0) = 1^1(0^0))))))))|]

  , TestCase "orbis" "scriptLimitsCohere"
    [r|Translated OSL:
(all <74^0, ((all <42^2, ((41^3(75^1(1^0), 76^1(1^0), 0^0) = 0) | (some <9^2, ((7^3(75^1(2^0), 76^1(2^0), 0^0) = 3^3(40^3(75^1(2^0), 76^1(2^0), 1^0), 75^1(2^0), 76^1(2^0))) & (8^3(75^1(2^0), 76^1(2^0), 0^0) = 4^3(40^3(75^1(2^0), 76^1(2^0), 1^0), 75^1(2^0), 76^1(2^0))))))) & (all <66^2, (some <9^2, ((7^3(75^1(2^0), 76^1(2^0), 0^0) = 3^3(67^3(1^0), 75^1(2^0), 76^1(2^0))) & (8^3(75^1(2^0), 76^1(2^0), 0^0) = 4^3(67^3(1^0), 75^1(2^0), 76^1(2^0))))))))|]

  , TestCase "orbis" "valuesEqual"
    [r|Translated OSL:
(all <2^0, ((11^2(0^1(0^0), 1^1(0^0)) = 20^2(0^1(0^0), 1^1(0^0))) & ((11^2(0^1(0^0), 1^1(0^0)) = 0) | (5^2(0^1(0^0), 1^1(0^0)) = 14^2(0^1(0^0), 1^1(0^0))))))|]

  , TestCase "orbis" "inputValuesCohere"
    [r|Translated OSL:
(all <79^0, (all <23^2, ((some <4096, (some <4096, (some <4096, (((22^3(80^1(4^0), 81^1(4^0), 3^0) = 0) & (((22^3(80^1(4^0), 81^1(4^0), 3^0) = 0) & (((17^3(80^1(4^0), 81^1(4^0), 3^0) = 0^0) & (18^3(80^1(4^0), 81^1(4^0), 3^0) = 1^0)) & (19^3(80^1(4^0), 81^1(4^0), 3^0) = 2^0))) | ((22^3(80^1(4^0), 81^1(4^0), 3^0) = 1) & ((20^3(80^1(4^0), 81^1(4^0), 3^0) = 0) & (21^3(80^1(4^0), 81^1(4^0), 3^0) = 0))))) & (some <11^2, (all <20^0, ((40^5(12^1(0^0), 13^1(0^0)) = 10^5(12^1(0^0), 13^1(0^0))) & ((40^5(12^1(0^0), 13^1(0^0)) = 0) | (34^5(2^0, 3^0, 4^0, 12^1(0^0), 13^1(0^0)) = 4^5(80^1(6^0), 81^1(6^0), 1^0, 12^1(0^0), 13^1(0^0))))))))))) | (some <4096, (some <4096, (((22^3(80^1(3^0), 81^1(3^0), 2^0) = 0) & (((22^3(80^1(3^0), 81^1(3^0), 2^0) = 0) & (((17^3(80^1(3^0), 81^1(3^0), 2^0) = 0) & (18^3(80^1(3^0), 81^1(3^0), 2^0) = 0)) & (19^3(80^1(3^0), 81^1(3^0), 2^0) = 0))) | ((22^3(80^1(3^0), 81^1(3^0), 2^0) = 1) & ((20^3(80^1(3^0), 81^1(3^0), 2^0) = 0^0) & (21^3(80^1(3^0), 81^1(3^0), 2^0) = 1^0))))) & (some <11^2, (all <19^0, ((95^4(12^1(0^0), 13^1(0^0)) = 10^5(12^1(0^0), 13^1(0^0))) & ((95^4(12^1(0^0), 13^1(0^0)) = 0) | (89^4(2^0, 3^0, 12^1(0^0), 13^1(0^0)) = 4^5(80^1(5^0), 81^1(5^0), 1^0, 12^1(0^0), 13^1(0^0)))))))))))))|]

  , TestCase "orbis" "rollupIsValid"
    [r||]

  , TestCase "orbis" "rootOutsEqual"
    [r|Translated OSL:
((3^0 = 13^0) & (all <2^0, ((12^2(0^1(0^0), 1^1(0^0)) = 22^2(0^1(0^0), 1^1(0^0))) & ((12^2(0^1(0^0), 1^1(0^0)) = 0) | (6^2(0^1(0^0), 1^1(0^0)) = 16^2(0^1(0^0), 1^1(0^0)))))))|]

  , TestCase "orbis" "rollupHashUpToTimeIs"
    [r|Translated OSL:
(0 = 0)|]

  , TestCase "orbis" "checkFeeParamUnrolling"
    [r|Translated OSL:
(((10^1(0) = 1) & ((10^1(0) = 0) | ((1^1(0) = 12^1(0)) & ((2^1(0) = 13^1(0)) & ((3^1(0) = 14^1(0)) & ((4^1(0) = 15^1(0)) & ((5^1(0) = 16^1(0)) & (6^1(0) = 17^1(0))))))))) & (all <4096, (((0^0 = 576460748008456192) | ((10^1((0^0 + 1)) = 0) & ((12^1((0^0 + 1)) = 12^1(0^0)) & ((13^1((0^0 + 1)) = 13^1(0^0)) & ((14^1((0^0 + 1)) = 14^1(0^0)) & ((15^1((0^0 + 1)) = 15^1(0^0)) & ((16^1((0^0 + 1)) = 16^1(0^0)) & (17^1((0^0 + 1)) = 17^1(0^0))))))))) | ((10^1((0^0 + 1)) = 1) & ((10^1((0^0 + 1)) = 0) | ((1^1((0^0 + 1)) = 12^1((0^0 + 1))) & ((2^1((0^0 + 1)) = 13^1((0^0 + 1))) & ((3^1((0^0 + 1)) = 14^1((0^0 + 1))) & ((4^1((0^0 + 1)) = 15^1((0^0 + 1))) & ((5^1((0^0 + 1)) = 16^1((0^0 + 1))) & (6^1((0^0 + 1)) = 17^1((0^0 + 1)))))))))))))|]

  , TestCase "inverse" "inverseLaw"
     [r|Translated OSL:
(all <4096, (1^1^-1(1^1(0^0)) = 0^0))|]

  , TestCase "constants" "inExampleSet"
    [r|Translated OSL:
P0^1(0^0)

Aux Data:
AuxTables {functionTables = fromList [], predicateTables = fromList [(P0^1,fromList [[1],[5],[10]])]}|]

  , TestCase "constants" "foo"
    [r|Translated OSL:
P0^1(0^1(1))

Aux Data:
AuxTables {functionTables = fromList [(0^1,fromList [([1],10),([10],100)])], predicateTables = fromList [(P0^1,fromList [[1],[5],[10]])]}|]
  ]
